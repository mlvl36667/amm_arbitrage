      
# Numerical Simulation for Optimal Liquidation Model

This repository provides C++ code, a Bash runner script, and a Python analysis script for numerically solving aspects of an optimal liquidation model in a limit order book. The methodology and model are related to the research presented in:

The C++ code (`integrator.cpp`) iteratively calculates a probability density function according to the model. The Bash script (`run_integrator.sh`) automates the compilation and execution of these simulations over a range of parameters. The Python script (`extract_trade_region.py`) then parses specific output files to summarise key metrics.

## Repository Contents

*   `README.md`: This instruction file.
*   `integrator.cpp`: The core C++ simulation code that implements the iterative numerical solution.
*   `iteration_solver`: The compiled executable of `integrator.cpp` (this is generated by `run_integrator.sh`).
*   `extract_trade_region.py`: A Python script designed to parse `tails_ratio_*.txt` files and display a formatted summary of the "tails ratio."
*   `run_integrator.sh`: A Bash script that automates the compilation of `integrator.cpp` and manages running simulations across a defined parameter space.

## Prerequisites

*   **C++ Compiler:** A C++ compiler with C++20 support (e.g., g++).
*   **OpenMP:** Required for parallel execution features within the `integrator.cpp` code.
*   **Boost Libraries:** The Boost Math library is used, specifically for `gauss_kronrod` quadrature. Development headers are necessary (e.g., `libboost-math-dev` on Debian/Ubuntu systems or equivalent for other systems like macOS with Homebrew).
*   **Bash:** For executing the `run_integrator.sh` script.
*   **`bc` command-line utility:** Used by the `run_integrator.sh` script for arbitrary precision arithmetic when setting parameters.
*   **Python 3:** For running the `extract_trade_region.py` analysis script.
*   Standard Linux/macOS command-line utilities (e.g., `rm`, `mkdir`, `mv`, `tr`, `sed`, `find`, `ls`).

## Usage Instructions

### 1. Setup and Compilation

The `run_integrator.sh` script handles the compilation of the C++ code. Before running, ensure the script is executable:
```bash
chmod +x run_integrator.sh
```


### 2. Running Simulations

To execute the simulation suite, run the Bash script:
```bash
./run_integrator.sh
```

This script will perform the following actions:

*    Clean up output files and directories from previous runs (be cautious as it uses rm -rf).
*    Compile integrator.cpp using g++ (with OpenMP and Boost flags) to create the iteration_solver executable.
*    Iterate through a predefined set of parameters (Sigma, Gamma, Q, P values, which are defined within the script) to run multiple instances of the iteration_solver.
*    Environment variables are set for each run to pass parameters to the C++ programme.
*    Store detailed logs from each simulation run in the simulation_results/ directory.
*    Store full CSV outputs (containing the iterated functions f0, f1, ...) from each run in the simulation_results/ directory.
*    Collect summary tails_ratio_*.txt and extra_calc_*.txt files (generated by iteration_solver) into the tails_ratios/ directory.

Parameters such as OMP_THREADS, FIXED_SIGMA, GAMMA_BP_VALUES, Q_VALUES, and P_EXPRESSIONS can be modified directly within the run_integrator.sh script to explore different scenarios.

## 3. Analysing Results

After the `run_integrator.sh` script has completed its runs, the `tails_ratios/` directory will contain the summary output files. The `extract_trade_region.py` script can then be used to parse these files. It prints a formatted summary to the console.

Run the Python analysis script using:

```bash
python3 extract_trade_region.py
```

## Output Description

The outputs of the execution are as follows:

*    iteration_solver: The compiled C++ executable programme.
*    simulation_results/ Directory: log_*.txt: Contains the standard output and error streams (log messages, warnings, etc.) from each individual run of iteration_solver. The filename reflects the parameters used.
*    f_out_S<sigma>_M<mu>_G<gamma>_QH<q>_P.csv: A CSV file for each parameter combination, containing the x-grid values and the corresponding values of the iterated density functions (f0, f1, ..., fN).
*    tails_ratios/ Directory: tails_ratio_Q_P<p>_GP<gamma>_GM<gamma>_CS<sigma>_CM<mu>.txt: Text files, each containing a single floating-point number representing the calculated "tails ratio percentage" for a specific parameter set, as output by iteration_solver.
*    extra_calc_Q<q>_P<p>_GP<gamma>_GM<gamma>_CS<sigma>_CM<mu>_Th<theta>.txt: Text files containing additional calculated terms (like c1, c2, and components of the extra cost terms) for specific parameter sets, as output by iteration_solver.
*    Console Output (from extract_trade_region.py): A table printed to the standard output, summarising Gamma (in basis points), the raw P value string, 1/P (formatted as a time duration), and the Tails Ratio (%) for the filtered set of results.

## Important Notes

    The C++ programme iteration_solver reads several key parameters (Q_FOR_H, P_PROBABILITY, GAMMA_PLUS, GAMMA_MINUS, CONST_SIGMA, CONST_MU) from environment variables. The run_integrator.sh script is responsible for setting these for each simulation run.
    The number of iterations for the density function calculation (NUM_ITER) is primarily controlled within integrator.cpp (hardcoded default which can be overridden by an environment variable NUM_ITERATIONS if get_double_from_env is used for it) and also referenced as a variable in run_integrator.sh (though it might not be directly passed if the C++ uses its internal default).
    The run_integrator.sh script calculates MU based on SIGMA using the relationship MU = SIGMA^2 / 2.
    The tails_ratios/ directory is created by run_integrator.sh to store the .txt files generated by iteration_solver.
